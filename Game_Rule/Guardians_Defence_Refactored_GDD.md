# 《守護者防線：雷霆遺產》遊戲設計企劃書 (GDD) - v3.26

## 1. 遊戲概述 (Game Overview)
**類型**: Deck-Building Game (DBG) / Roguelite防塔  
**平台**: Web Browser (Mobile First, Desktop Responsive)  
**核心體驗**: 玩家扮演村莊的指揮官，透過管理手牌資源（英雄、武器、道具）來抵禦不斷進逼的地城怪物。遊戲結合了《雷霆之石》的市場構建機制與Roguelite的隨機挑戰。

---

## 2. 系統架構 (System Architecture)
本專案採用 **Controller-Engine** 模式進行開發，確保邏輯模組化與易於維護。

### 2.1 核心控制器 (`src/game.js`)
- **GameController**: 遊戲的中央大腦，負責狀態管理 (`GameState`)、回合推進 (`nextTurn`)、以及調度各個子引擎。
- **UI Manager**: 負責所有 DOM 操作與畫面渲染。

### 2.2 子引擎模組 (`src/engine/`)
1.  **CardEngine**: 掌管卡牌數據、牌庫生成、洗牌邏輯與市集刷新。
2.  **VillageEngine**: 處理村莊內的經濟活動（購買、升級、轉職）與休息機制（銷毀卡牌、回復 HP）。
3.  **DungeonEngine**: 管理怪物的生成 (`Spawn`)、進軍 (`Advance`) 與突破懲罰 (`Breach`)。
4.  **CombatEngine**: 核心戰鬥計算模組。
    - **輸入**: 英雄 + 武器 + 輔助道具 + 目標怪物。
    - **計算**: 綜合 Strength, Attack, Magic, Light Penalty (光照懲罰) 與 Aura (靈氣) 效果。
    - **輸出**: 最終傷害值與戰鬥結果。

---

## 3. 遊戲流程 (Game Loop)

遊戲以「回合 (Turn)」為單位，每回合包含以下階段：

### 3.1 抽牌階段 (Draw Phase)
- 系統自動從牌庫抽取 **6 張** 手牌。
- 若牌庫耗盡，則將棄牌堆洗牌後組成新牌庫。

### 3.2 行動階段 (Action Phase)
玩家必須從以下三種行動中擇一執行：

#### A. 造訪村莊 (Visit Village) - *經濟與建設*
- **啟用資源**: 玩家打出手牌中的物資與道具，累積「金幣」與觸發「村莊效果」。
- **購買/訓練**: 
    - 使用金幣從市集購買新卡牌（放入棄牌堆）。
    - 支付 XP 將英雄升級 (Lv1 -> Lv2 -> Lv3)。
    - 支付 1 XP 將「正規軍」轉職為任意市集英雄 (Lv1)。
- **聖杯能力**: 若有聖杯騎士，可在此階段執行「銷毀卡牌」或「修復護罩」。

#### B. 進入地城 (Enter Dungeon) - *戰鬥與討伐*
- **戰鬥配置**: 玩家需從手牌中選定：
    1. **出戰英雄** (必要)
    2. **裝備武器** (選用，需滿足 STR 需求)
    3. **輔助道具** (選用，如乾糧、藥水)
    - *UI 支援三欄位點選配置。*
- **選擇目標**: 點擊地城中的 Rank 1/2/3 怪物。
- **光照判定**: 計算總光照值 (Light) vs 該 Rank 光照需求。不足部分將轉化為 **2倍攻擊力懲罰**。
- **戰鬥結算**: 
    - **勝利**: 怪物移入棄牌堆 (成為分數/資源)，獲得 XP，觸發勝利效果。
    - **戰敗**: 怪物留在場上，卡牌進入棄牌堆，無任何獎勵。

#### C. 休息整補 (Rest) - *清理與回復*
- **獲得 XP**: 強制獲得 1 XP。
- **卡牌銷毀**: 可選擇手牌中任意 1 張卡牌進行「銷毀」(移除遊戲)，此功能用於精簡牌庫 (Trash)。

### 3.3 回合結束 (End Turn)
1.  **棄牌**: 所有手牌與已打出的卡牌進入棄牌堆。
2.  **怪物進軍 (Advance)**: 
    - 地城空缺將由後方怪物遞補。
    - 若 Rank 1 怪物推進至村莊，將觸發 **突破 (Breach)**：扣除村莊護罩 (HP)，並觸發該怪物的進場特效 (如破壞手牌)。
3.  **回合數 +1**: 進入下一回合。

---

## 4. 關鍵機制詳解

### 4.1 光照系統 (Light System)
地城深處漆黑一片，攻擊深處的怪物需要照明。
- **光照需求**: Rank 1 (1 Light), Rank 2 (2 Light), Rank 3 (3 Light)。
- **懲罰公式**: `(需求 - 手牌光照值) * 2 = 攻擊力懲罰`。
- *例*: 攻擊 Rank 3 怪物，手牌只有 1 光照。缺 2 光照 = 扣除 4 點攻擊力。

### 4.2 屬性與協同 (Stats & Harmony)
- **力量 (Strength/STR)**: 決定英雄能否舉起重型武器，同時作為基礎物理攻擊力。
- **魔法攻擊 (Magic Attack)**: 無視物理防禦，且不受部分物理減傷效果影響 (如泥漿怪)。
- **協同 (Synergy)**: 特定卡牌組合會觸發加成。
    - *正規軍 + 長矛*
    - *亞馬遜 + 獵弓*
    - *塞維恩 + 其他英雄*

### 4.3 勝利與失敗
- **勝利條件**: (目前版本為無盡模式/積分制) 盡可能存活並累積 VP。
- **失敗條件**: 村莊 **魔法護罩 (Village HP)** 歸零。

---

## 5. UI/UX 設計規範 (v3.26)
- **配色**: 深色奇幻風格 (#1a1a1a 背景)，強調色為金黃 (Gold)、赤紅 (Danger)、青藍 (Magic)。
- **RWD 響應式**:
    - **Desktop**: 1280px 置中，左側 Log 面板，右側遊戲舞台，上方固定狀態列。
    - **Mobile**: 單欄垂直堆疊，隱藏次要資訊，各狀態數值採堆疊顯示 (Icon/Value Stacked) 以節省橫向空間。
- **資訊層級**:
    1. **狀態**: HP, XP, Turn (置頂)
    2. **地城**: 怪物卡片 (Rank 3 -> Rank 1)
    3. **行動區**: 玩家手牌與操作按鈕 (置底，方便手指點擊)

---
*Last Updated: 2026-01-05 (v3.26)*
